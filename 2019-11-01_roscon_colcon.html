<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>colcon - Universal Build Tool</title>

    <meta name="description" content="Description of colcon at ROSCon 2019">
    <meta name="author" content="Dirk Thomas">

    <link rel="stylesheet" href="css/bootstrap-4.3.1.css">

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/white.css">

    <link rel="stylesheet" href="css/openrobotics.css">

    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement( 'link' );
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
      document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>
  </head>
  <body>
    <div class="reveal">
      <div class="slides">
        <div class="openrobotics-signature">
          <svg id="openrobotics-logo" height="1.8em" width="1.8em" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <image id="openrobotics-logo-image" x="0" y="0" height="100%" width="100%" xlink:href="image/osrf-logo.svg"/>
            <animateTransform id="openrobotics-logo-clockwise" xlink:href="#openrobotics-logo-image" attributeName="transform" attributeType="XML"
              type="rotate" from="0 27 27" to="360 27 27" dur="1.0s" calcMode="spline" keySplines="0.5 0 0.5 1" keyTimes="0;1" begin="indefinite" repeatCount="0" fill="freeze"/>
            <animateTransform id="openrobotics-logo-counterclockwise" xlink:href="#openrobotics-logo-image" attributeName="transform" attributeType="XML"
              type="rotate" from="360 27 27" to="0 27 27" dur="1.0s" calcMode="spline" keySplines="0.5 0 0.5 1" keyTimes="0;1" begin="indefinite" repeatCount="0" fill="freeze"/>
            <animate id="openrobotics-logo-flash" attributeType="CSS" attributeName="opacity"
              dur="0.7s" values="1; 0.25; 1" keyTimes="0; 0.25; 1" repeatCount="0" />
          </svg>
          <svg id="openrobotics-lettering" height="1.6em" width="32%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <image x="-95" y="-5" height="100%" width="100%" xlink:href="image/openrobotics-lettering.svg"/>
          </svg>
        </div>

        <section>
          <h1>colcon</h1>
          <img src="image/colcon.svg" width="20%" style="text-align: left; margin-top: -45px; margin-bottom: -10px" alt=""/>
          <h3>Universal Build Tool</h3>
          <p>
            <small>
              Nov. 1st 2019, Dirk Thomas<br/>
              ROSCon 2019, Macau, China
            </small>
          </p>
          <aside class="notes">
            <i>Finish by 0:30 min.</i>
            <ul>
              <li>ROS encourages you to write modular code</li>
              <li>With its advantage comes the fact that you will have many separate packages to build for a specific application</li>
              <li>That is where a build tool like colcon comes in to keep it as convenient as possible to build your code</li>
            </ul>
          </aside>
        </section>

        <section>
          <section>
            <h2>Building a package</h2>
            <ul>
              <li class="fragment" data-fragment-index="1">
                Prerequisites:
                <ul>
                  <li>all external dependencies are available</li>
                  <li>the environment is set up to make ext. dep. locatable</li>
                </ul>
              </li>
              <li style="color: gray"><b>Input:</b> the sources of a package</li>
              <li class="fragment" data-fragment-index="1">
                Build the package using its <i>build system</i>
                <ul>
                  <li class="fragment" data-fragment-index="1">Install the package artifacts</li>
                </ul>
              </li>
              <li>
                <span style="color: gray"><b>Output:</b> artifacts ready to be used</span>
                <ul>
                  <li class="fragment" data-fragment-index="1">
                    Setup the environment to use the installed package
                  </li>
                </ul>
              </li>
            </ul>
            <div style="border: 1px solid red; font-size: 0.8em; margin-top: 1em; margin-left: 15%; width: 70%" class="fragment" data-fragment-index="2">
              <b>No</b>, we don't want to read the <code>README</code> to figure out:
              <ul style="margin-left: 0">
                <li>what dependencies are needed</li>
                <li>what build system is being used and how to invoke it</li>
                <li>what environment variables need to be updated before / after</li>
              </ul>
            </div>
            <aside class="notes">
              <i>Finish by 1:00 min.</i>
              <ul>
                <li>A brief overview what is needed to build a package.</li>
                <li>Commonly we don't install artifacts globally into <code>/usr</code> since we might want to have multiple different versions of a package installed in different environments.</li>
              </ul>
            </aside>
          </section>

          <section>
            <h2>Building a set of packages</h2>
            <ul>
              <li style="color: gray">
                Prerequisites:
                <ul>
                  <li>all external dependencies are available</li>
                  <li>the environment is set up<br/>to make ext. dep. locatable</li>
                </ul>
              </li>
              <li style="color: gray"><b>Input:</b> the sources of a set of packages</li>
              <li class="fragment" data-fragment-index="1">Compute the dependency graph</li>
              <li class="fragment" data-fragment-index="1">Process the packages in topological order:<br/><span class="fragment" data-fragment-index="2">for each package</span>
                <ul>
                  <li class="fragment" data-fragment-index="2">Update the environment to include previous built packages which the package depends on</li>
                  <li class="fragment" data-fragment-index="2">Build and install the package using its <i>build system</i></li>
                </ul>
              </li>
              <li>
                <span style="color: gray"><b>Output:</b> artifacts ready to be used</span>
                <ul class="fragment" data-fragment-index="2">
                  <li>
                    Setup the environment to use all installed packages
                  </li>
                </ul>
              </li>
            </ul>
            <img style="position: absolute; right: -0.5em; top: 10%; width: 11.5em" class="fragment" data-fragment-index="1" src="image/processing-order.gif"/>
            <p style="position: absolute; right: 5em; top: 42%; width: 7em; line-height: 1.0" class="fragment" data-fragment-index="1">
              <span style="font-size: 0.7em">Generated by<br/><a href="https://github.com/colcon/colcon-graphviz-anim">colcon-graphviz-anim</a></span>
            </p>
            <aside class="notes">
              <i>Finish by 1:45 min.</i>
              <ul>
                <li>As mentioned commonly you won't build just a single package but multiple</li>
                <li>That will add the complexity of building packages in the right order</li>
                <li>It also makes the automated environment setup a requirement</li>
            </ul>
            </aside>
          </section>

          <section>
            <h2>Wait, don't we have that already?</h2>
            <table class="buildtools" style="font-size: 0.8em">
              <tr>
                <th></th>
                <th><span class="fragment" data-fragment-index="1">1.</span></th>
                <th><span class="fragment" data-fragment-index="2">2.</span></th>
                <th><span class="fragment" data-fragment-index="3">3.</span></th>
                <th><span class="fragment" data-fragment-index="4">4.</span></th>
                <th><span class="fragment" data-fragment-index="5">5.</span></th>
                <th><span class="fragment" data-fragment-index="6">6.</span></th>
                <th><span class="fragment" data-fragment-index="7">7.</span></th>
                <th><span class="fragment" data-fragment-index="8">8.</span></th>
              </tr>
              <tr>
                <td>catkin_make:</td>
                <td><span class="fragment" data-fragment-index="1"><img src="image/emoji-headache.png"/></span></td>
                <td><span class="fragment" data-fragment-index="2"><img src="image/emoji-omg.png"/></span></td>
                <td><span class="fragment" data-fragment-index="3"><img src="image/emoji-sad.png"/></span></td>
                <td></td>
                <td><span class="fragment" data-fragment-index="5"><img src="image/emoji-zippy.png"/></span></td>
                <td></td>
                <td><span class="fragment" data-fragment-index="7"><img src="image/emoji-blush.png"/></span></td>
                <td><span class="fragment" data-fragment-index="8"><img src="image/emoji-worried.png"/></span></td>
                <td></td>
              </tr>
              <tr>
                <td>catkin_make_isolated:</td>
                <td></td>
                <td><span class="fragment" data-fragment-index="2">&nbsp;<img src="image/emoji-omg.png" width="50%"/></span></td>
                <td><span class="fragment" data-fragment-index="3"><img src="image/emoji-sad.png"/></span></td>
                <td></td>
                <td><span class="fragment" data-fragment-index="5"><img src="image/emoji-zippy.png"/></span></td>
                <td><span class="fragment" data-fragment-index="6"><img src="image/emoji-sleepy.png"/></span></td>
                <td><span class="fragment" data-fragment-index="7">&nbsp;<img src="image/emoji-blush.png" width="50%"/></span></td>
                <td><span class="fragment" data-fragment-index="8"><img src="image/emoji-worried.png"/></span></td>
                <td></td>
              </tr>
              <tr>
                <td>catkin_tools:</td>
                <td></td>
                <td></td>
                <td><span class="fragment" data-fragment-index="3">&nbsp;<img src="image/emoji-sad.png" width="50%"/></span></td>
                <td><span class="fragment" data-fragment-index="4"><img src="image/emoji-facepalm.png"/></span></td>
                <td><span class="fragment" data-fragment-index="5"><img src="image/emoji-zippy.png"/></span></td>
                <td></td>
                <td></td>
                <td><span class="fragment" data-fragment-index="8">&nbsp;<img src="image/emoji-worried.png" width="50%"/></span></td>
              </tr>
              <tr>
                <td>ament_tools:</td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td><span class="fragment" data-fragment-index="5">&nbsp;<img src="image/emoji-zippy.png" width="50%"/></span></td>
                <td><span class="fragment" data-fragment-index="6"><img src="image/emoji-sleepy.png"/></span></td>
                <td><span class="fragment" data-fragment-index="7"><img src="image/emoji-blush.png"/></span></td>
                <td><span class="fragment" data-fragment-index="8">&nbsp;<img src="image/emoji-worried.png" width="50%"/></span></td>
                <td></td>
              </tr>
            </table>
            <p style="font-size: 0.8em; margin-left: 3em; text-align: left">
              <b>But...</b>
            </p>
            <ol style="font-size: 0.8em">
              <li class="fragment" data-fragment-index="1">A pkg shouldn't need to know about the internals of other pkgs</li>
              <li class="fragment" data-fragment-index="2">Should be deterministic - unrelated pkgs shouldn't affect the result</li>
              <li class="fragment" data-fragment-index="3">Ability to process various package types, e.g. CMake, Python, &lt;put-your-here&gt;</li>
              <li class="fragment" data-fragment-index="4">Native support for Linux, macOS, and Windows</li>
              <li class="fragment" data-fragment-index="5">Support packages "as-is", e.g. no <code>package.xml</code> as for FastRTPS</li>
              <li class="fragment" data-fragment-index="6">Build as fast as possible </li>
              <li class="fragment" data-fragment-index="7">Good user experience / usability features</li>
              <li class="fragment" data-fragment-index="8">Extensible code base</li>
            </ol>
            <aside class="notes">
              <i>Finish by 2:30 min.</i>
              <ul>
                <li>No time to go into details here</li>
              </ul>
            </aside>
          </section>
        </section>

        <section>
          <section>
            <h2 style="font-weight: normal">
              <img src="image/colcon.svg" alt="" style="height: 2em"/>
              <b>col</b>lective <b>con</b>struction
            </h2>
            <p style="text-align: left">
              <b>High level goals</b>
            </p>
            <ul style="font-size: 0.9em">
              <li>The tool should make building, testing and using multiple packages easy</li>
              <li>It should be possible to add support for<br/>any kind of build system using extensions</li>
              <li>It should be possible to build any set of packages without requiring changes to their sources - if necessary missing information can be provided externally, e.g.:
                <ul style="font-size: 0.9em">
                  <li>Build Ignition packages</li>
                  <li>Handle one-off cases, e.g. pass <code>-DENABLE_FOO</code> to a single package</li>
                </ul>
              </li>
              <li>After building packages they must be immediately usable<br/>which includes setting up necessary environment variables etc.</li>
            </ul>
            <p style="color: gray; font-size: 0.6em; text-align: right">
              From <a href="https://colcon.readthedocs.io/en/released/developer/design.html">colcon.readthedocs.io</a>
            </p>
            <aside class="notes">
              <i>Finish by 3:30 min.</i>
              <ul>
                <li>Biggest highlights over existing tools: cross platforms, process untouched package using external metadata</li>
              </ul>
            </aside>
          </section>

          <section>
            <h2 style="font-weight: normal">
              <img src="image/colcon.svg" alt="" style="height: 2em"/>
              <b>col</b>lective <b>con</b>struction
            </h2>
            <p style="color: gray; text-align: left">
              <b>Out of scope - covered by other tools</b>
            </p>
            <ul style="color: gray; font-size: 0.9em">
              <li>Fetch sources of the packages &rarr; <code>vcstool</code></li>
              <li>Install dependencies of the packages &rarr; <code>rosdep</code></li>
              <li>Create pkg-level binary packages (e.g. <code>.deb</code>) &rarr; <code>bloom</code>, <code>dpkg-buildpackage</code></li>
            </ul>
            <p style="color: gray; font-size: 0.6em; text-align: right">
              From <a href="https://colcon.readthedocs.io/en/released/developer/design.html">colcon.readthedocs.io</a>
            </p>
            <aside class="notes">
              <i>Finish by 3:50 min.</i>
            </aside>
          </section>

          <section>
            <h2 style="font-weight: normal">
              <img src="image/colcon.svg" alt="" style="height: 2em"/>
              <b>col</b>lective <b>con</b>struction
            </h2>
            <p style="text-align: left">
              <b>Software engineering goals</b>
            </p>
            <ul style="font-size: 0.9em">
              <li>All the functionality provided should be exposed in a way<br/>that it can be reused by other extensions</li>
              <li>The separation into multiple Python packages is being used to encourage modularity and loose coupling (<a href="https://en.wikipedia.org/wiki/Law_of_Demeter">Law of Demeter</a>), it is also used to<br/>demonstrate extensibility and show that certain features are not "special"<br/>but can be contributed externally</li>
              <li>Each component should have responsibility over a single part of the software (<a href="https://en.wikipedia.org/wiki/Single_responsibility_principle">Single responsibility principle</a>)</li>
              <li>Each functionality added should follow the principle<br/>"you don’t pay for what you don’t use"</li>
            </ul>
            <p style="color: gray; font-size: 0.6em; text-align: right">
              From <a href="https://colcon.readthedocs.io/en/released/developer/design.html">colcon.readthedocs.io</a>
            </p>
            <aside class="notes">
              <i>Finish by 4:00 min.</i>
              <ul>
                <li>Common software engineering goal, not going into detail here</li>
              </ul>
            </aside>
          </section>
        </section>

        <section>
          <section>
            <h2>Setup colcon</h2>
            <ul style="text-align: left; width: 100%">
              <li>Install <code>colcon</code> including common extensions, via:
                <ul style="font-size: 0.9em">
                  <li>the Debian package <code>python3-colcon-common-extensions</code> or</li>
                  <li>the Python package <code>colcon-common-extensions</code></li>
                </ul>
              </li>
              <li class="fragment" style="margin-top: 1em">Using <code>bash</code> or <code>zsh</code>? Get completion!
                <ul style="font-size: 0.9em">
                  <li>Install <code>python3-argcomplete</code> [deb] / <code>argcomplete</code> [pip]</li>
                  <li>Source the completion script <code>colcon-argcomplete.bash|zsh</code> from:
                    <ul style="font-size: 0.9em">
                      <li><code>/usr/share/colcon_argcomplete/hook/</code> or</li>
                      <li><code>$HOME/.local/share/colcon_argcomplete/hook/</code></li>
                    </ul>
                  </li>
                </ul>
              </li>
              <li class="fragment" style="margin-top: 1em">Liked <code>roscd</code>? Try <code>colcon_cd</code>
                <ul style="font-size: 0.9em">
                  <li>Source the script <code>colcon_cd.sh</code> (similar location)</li>
                </ul>
              </li>
              <li class="fragment" style="margin-top: 1em">Check for updates in the future: <code>colcon version-check</code></li>
            </ul>
            <p style="font-size: 0.8em; margin-top: 1em; text-align: right">
              For more details see <a href="https://colcon.readthedocs.io/en/released/user/installation.html">colcon.readthedocs.io</a>
            </p>
            <aside class="notes">
              <i>Finish by 4:45 min.</i>
              <ul>
                <li>Install, favor debs over pip</li>
                <li>Setup completion</li>
                <li>Source script for cd helper</li>
                <li>Check for updates</li>
              </ul>
            </aside>
          </section>

          <section>
            <h2>Workspace Layout</h2>
            <p>
              In ROS the sources of the packages to be processes are commonly placed
              <ul>
                <li>within a workspace root <code>&lt;ws&gt;</code></li>
                <li>in a subdirectory named <code>src</code></li>
              </ul>
            </p>
            <pre>

  &lt;ws&gt;
  |-- src
      |-- <span class="fragment highlight-current-blue" data-fragment-index="1">dir1</span>
          |-- package.xml [with the name tag containing "pkg1"]
          |-- <span class="fragment highlight-current-blue" data-fragment-index="2">some_name</span>
              |-- package.xml [nested under another package <span style="color: #e83e8c">not</span> supported]
      |-- dir2
          |-- <span class="fragment highlight-current-blue" data-fragment-index="3">dir3</span>
              |-- CMakeLists.txt [with the function call "project(pkg3)"]
          |-- <span class="fragment highlight-current-blue" data-fragment-index="3">dir4</span>
              |-- setup.py [with the setup argument "name='pkg4'"]
      |-- <span class="fragment highlight-current-blue" data-fragment-index="4">dir5</span>
          |-- COLCON_IGNORE [empty marker file]
          |-- ...
            </pre>
            <aside class="notes">
              <i>Finish by 5:30 min.</i>
              <ul>
                <li>Commonly you place all packages you want to build into the source directory of a workspace</li>
                <li>Packages can't be nested</li>
                <li>Packages might have a package.xml (or not) more on that later</li>
                <li>Ignore marker</li>
              </ul>
            </aside>
          </section>
        </section>

        <section>
          <section>
            <h2><code>build</code> Command</h2>
            <ul style="font-size: 0.8em; margin-left: 0">
              <li style="padding-right: 15em">Build all packages in the workspace: <code>colcon build</code>
                <ul style="font-size: 0.9em; margin-left: 0">
                  <li>Minimal output showing progress on a by-package level (if everything goes smooth)</li>
                  <li>By default if any package fails all ongoing packages are aborted, no others are started</li>
                  <li>E.g. pass custom CMake args: <code>--cmake-args</code><br/>which are applied to all processed packages</li>
                </ul>
              </li>
            </ul>
            <pre style="font-size: 0.5em; position: absolute; right: -1em; top: 10%; width: 22em">

  $ <span style="color: #e83e8c">colcon build</span>
  Starting &gt;&gt;&gt; pkg1
  Starting &gt;&gt;&gt; pkg2
  Finished &lt;&lt;&lt; pkg1 [10s]
  Starting &gt;&gt;&gt; pkg3
  Finished &lt;&lt;&lt; pkg3 [10s]
  Starting &gt;&gt;&gt; pkg5
  Finished &lt;&lt;&lt; pkg2 [25s]
  Starting &gt;&gt;&gt; pkg4
  Finished &lt;&lt;&lt; pkg5 [20s]
  Finished &lt;&lt;&lt; pkg4 [20s]

  Summary: 5 packages finished [45s]
            </pre>

            <p style="font-size: 0.75em; font-style: italic; padding-left: 2em; text-align: left">
              Note: if you build more than once make sure to use <code>ccache</code>.
            </p>

            <p class="fragment" data-fragment-index="1" style="color: #44497a; font-size: 0.9em; margin-top: 20px; margin-bottom: 10px; text-align: left">Metadata</p>
            <ul style="font-size: 0.8em; margin-left: 0">
              <li class="fragment" data-fragment-index="1" style="padding-right: 13em">Sometimes you want to pass pkg-specific arguments
                <ul style="font-size: 0.9em; margin-left: 0">
                  <li>Via CLI that would be <s>cumbersome</s> verbose</li>
                  <li>Therefore being done via <code>yaml</code> files
                    <ul>
                      <li>A file named <code>./colcon.meta</code> is picked up automatically</li>
                      <li>Otherwise pass custom files using <code>--metas</code>
                    </ul>
                  </li>
                </ul>
              </li>
            </ul>

          <pre class="fragment" data-fragment-index="1" style="font-size: 0.5em; position: absolute; right: -1em; top: 56%; width: 24em">

  {
    <span class="fragment highlight-current-blue" data-fragment-index="2">"names"</span>: {
      <span class="fragment highlight-current-blue" data-fragment-index="3">"fastrtps"</span>: {
        <span class="fragment highlight-current-blue" data-fragment-index="4">"cmake-args"</span>: ["-DSECURITY=ON"]
      }
    }
  }
          </pre>

          <p class="fragment" data-fragment-index="1" style="font-size: 0.75em; font-style: italic; padding-left: 12em; text-align: left">
            See <a href="https://colcon.readthedocs.io/en/released/user/configuration.html#meta-files">colcon.readthedocs.io</a> for information about <code>.meta</code> files.<br/>
            See <a href="https://github.com/colcon/colcon-metadata-repository">colcon-metadata-repository</a> for information how to share such files.
          </p>

            <aside class="notes">
              <i>Finish by 7:00 min.</i>
            </aside>
          </section>

          <section>
            <h2>Event Handlers</h2>
            <ul style="font-size: 0.9em; margin-left: 0">
              <li>
                By default the actual output of the build isn't shown.
                <ul style="font-size: 0.9em">
                  <li>
                      Why? Because otherwise the output from concurrent packages would interleave.
                  </li>
                </ul>
              </li>
              <li class="fragment" data-fragment-index="2">
                Instead:
                <ul style="font-size: 0.9em">
                  <li>
                    Status line
                    <pre style="margin-left: -2em; width: 75%">

  [23s] [2/5 complete] [2 ongoing] [pkg2:install - 23s] [pkg5:cmake - 1s]
  </pre>
                  </li>
                  <li>
                    Any <code>stderr</code> output will be shown after a package finished
                    <ul style="font-size: 0.9em">
                      <li>
                        <code>stderr</code> output doesn't mean it failed
                      </li>
                      <li>
                        it could fail without <code>stderr</code> output (e.g. on Windows)
                      </li>
                    </ul>
                  </li>
                  <li>
                    But - also by default - any output it written to a <code>log</code> file
                  </li>
                </ul>
              </li>
              <li class="fragment" data-fragment-index="4" style="padding-top: 1em">
                See section <b style="color: #44497a">Event handler arguments</b> in <code>colcon build --help</code>
                <ul style="font-size: 0.9em">
                  <li>
                    Show all output after a pkg finished: <code>--event-handlers console_cohesion+</code>
                  </li>
                  <li>
                    Output on-the-fly (usually only when building a single pkg): <code>console_direct+</code>
                  </li>
                  <li>
                    The suffix <code>+</code> enables a specific handler, <code>-</code> disables it
                  </li>
                </ul>
              </li>
            </ul>
            <pre class="fragment" data-fragment-index="2" style="font-size: 0.35em; position: absolute; right: -1em; top: 39%; width: 22em">

  &lt;ws&gt;
  |-- <span class="fragment highlight-current-blue" data-fragment-index="3">log</span>
      |-- &lt;cmd&gt;_&lt;timestamp&gt;
      |-- latest_&lt;cmd&gt;
      |-- <span class="fragment highlight-current-blue" data-fragment-index="3">latest</span>
          |-- events.log
          |-- logger_all.log
          |-- <span class="fragment highlight-current-blue" data-fragment-index="3">&lt;pkg&gt;</span>
              |-- command.log
              |-- stderr.log
              |-- stdout.log
              |-- <span class="fragment highlight-current-blue" data-fragment-index="3">stdout_stderr.log</span>
              |-- streams.log
  </pre>

            <aside class="notes">
              <i>Finish by 8:30 min.</i>
            </aside>
          </section>
        </section>

        <section>
          <section>
            <h2><code>list</code> Command</h2>
            <pre style="position: absolute; right: -1em; top: 15%; width: 20em">

  &lt;ws&gt;
  |-- src
      |-- dir1
          |-- package.xml
          |-- some_name
              |-- package.xml
      |-- dir2
          |-- dir3
              |-- CMakeLists.txt
          |-- dir4
              |-- setup.py
      |-- dir5
          |-- COLCON_IGNORE
          |-- ...
            </pre>

            <ol style="font-size: 0.9em">
              <li class="fragment" style="font-size: 0.9em; padding-right: 12em">
                <b style="color: #44497a; font-size: 1.1em">Discovery</b><br/>Determine directories to check for a package
                <ul style="font-size: 0.9em; margin-left: 0">
                  <li>Default: recursively crawl for pkgs <code>--base-paths .</code></li>
                  <li>Alternatives:
                    <ul style="font-size: 0.9em; margin-left: 0">
                      <li>explicit (non-recursive) list of paths <code>--paths</code></li>
                      <li>get a list of paths from a configuration file <code>--metas</code></li>
                    </ul>
                  </li>
                  <li>See section <b style="color: #44497a">Discovery arguments</b> in<br/><code>colcon list --help</code> for all arguments</li>
                </ul>
              </li>
              <li class="fragment" style="font-size: 0.9em; padding-right: 12em">
                <b style="color: #44497a; font-size: 1.1em">Identification</b><br/>Determine if a directory contains a package<br/>as well as its name and type, e.g.:
                <ul style="font-size: 0.9em; margin-left: 0">
                  <li>ROS pkg: has a <code>package.xml</code> following a specific schema</li>
                  <li>CMake pkg: has a <code>CMakeLists.txt</code> file</li>
                  <li>Python pkg: has a <code>setup.py</code> file</li>
                </ul>
              </li>
              <li class="fragment" style="font-size: 0.9em">
                <b style="color: #44497a; font-size: 1.1em">Augmentation</b><br/>Add metadata to identified packages
                <ul style="font-size: 0.9em; margin-left: 0">
                  <li>E.g.: a package named <code>Gazebo</code> has a <code>share/gazebo/setup.sh</code> file which should be sourced (see <a href="https://github.com/colcon/colcon-metadata-repository/blob/master/Gazebo.meta">colcon-metadata-repository</a>)</li>
                </ul>
              </li>
            </ol>

            <pre class="fragment" style="position: absolute; right: -1em; bottom: 9.5%; width: 30em">

  $ <span style="color: #e83e8c">colcon list</span>
  pkg1  &lt;ws&gt;/src/dir1       (ros.ament_cmake)
  pkg3  &lt;ws&gt;/src/dir2/dir3  (cmake)
  pkg4  &lt;ws&gt;/src/dir2/dir4  (python)
            </pre>
            <aside class="notes">
              <i>Finish by 9:30 min.</i>
              <ul>
                <li>The list command is a great way to see what packages are in a workspace</li>
                <li>And show as which type they are being processed</li>
                <li>The following steps are happening behind the scene</li>
              </ul>
            </aside>
          </section>

          <section>
            <h2><code>info</code> Command</h2>
            <pre>

  $ <span style="color: #e83e8c">colcon info ament_cmake_core</span>
  <span class="fragment" data-fragment-index="1">path: &lt;ws&gt;/src/ament_cmake_core
      <span class="fragment highlight-current-blue" data-fragment-index="3">type: ros.ament_cmake</span>
      <span class="fragment highlight-current-blue" data-fragment-index="2">name: ament_cmake_core</span>
      <span class="fragment highlight-current-blue" data-fragment-index="4">dependencies:
        build: ament_package cmake python3-catkin-pkg-modules
        run: ament_package cmake python3-catkin-pkg-modules
        test:</span>
      metadata:
        version: 0.8.0</span>
            </pre>
            <ul style="font-size: 0.9em">
              <li class="fragment" data-fragment-index="3">The <code>ros.</code> prefix identifies that the package has a <code>package.xml</code> file</li>
              <li class="fragment" data-fragment-index="3" style="padding-bottom: 1em">Together with the <code>ament_cmake</code> suffix it determines<br/>how the package is processed</li>
              <li class="fragment" data-fragment-index="4">The dependencies are (in this case) extracted from the <code>package.xml</code> file</li>
              <li class="fragment" data-fragment-index="4">Some dependencies are package names in the workspace,<br/>others name external dependencies (those are irrelevant for colcon)</li>
            </ul>
            <aside class="notes">
              <i>Finish by 10:00 min.</i>
              <ul>
                <li>The info command provides details about a specific package</li>
                <li>Most importantly the dependencies</li>
              </ul>
            </aside>
          </section>

          <section>
            <h2><code>graph</code> Command</h2>
            Visualize the dependencies between packages

            <pre class="fragment" data-fragment-index="1" style="position: absolute; left: 0em; width: 37em">

  $ <span style="color: #e83e8c">colcon graph --legend</span>
  + marks when the package in this row can be processed
  * marks a direct dependency from the package indicated
    by the + in the same column to the package in this row
  . marks a transitive dependency

  pkg1  + **.
  pkg2   + *
  pkg3    + *
  pkg4     +
  pkg5      +
            </pre>

            <ul class="fragment" data-fragment-index="2" style="font-size: 0.8em; margin-top: 13em">
              <li>Processing the packages sequentially from top to bottom ensures the topological order</li>
              <li>Pkgs without dependencies between each other can be processed concurrently
                <ul>
                  <li>The order of <code>pkg4</code> and <code>pkg5</code> depends on which dependencies are completed first</li>
                </ul>
              </li>
            </ul>

            <p class="fragment fragment-current" data-fragment-index="3" style="position: absolute; right: 0; top: 21%; width: 35%">
              <img style="margin-bottom: 0" src="image/colcon-graph.png" width="50%" alt=""/><br/>
            </p>
            <p class="fragment fragment-current" data-fragment-index="3" style="position: absolute; right: 0; top: 63%; width: 35%">
              <span style="font-size: 0.7em; line-height: 1.0"><code>colcon graph --dot | dot ...</code></span>
            </p>
            <aside class="notes">
              <i>Finish by 11:00 min.</i>
            </aside>
          </section>
        </section>

        <section>
          <section>
            <h2>Package Selection Arguments</h2>
            <p style="font-size: 0.9em; text-align: left">
              Instead of processing all packages in a workspace you often<br/>want to only process a subset to speed up your workflow.
            </p>
            <p style="font-size: 0.9em; text-align: left">
              The following options apply to various commands:
            </p>

            <ul style="font-size: 0.8em; margin-left: 0">
              <li class="fragment" data-fragment-index="1">After making changes to packages:
                <ul style="font-size: 0.9em; margin-left: 0">
                  <li>Only process specific packages:<br/><code>--packages-select &lt;pkgname1&gt; [&lt;pkgname2&gt; ..]</code></li>
                  <li><i>Note: when used with <code>build</code> their dependencies must have been build before</i></li>
                </ul>
              </li>
              <li class="fragment" data-fragment-index="2">Don't know what has changed and only want to use <code>pkgX</code>?
                <ul style="font-size: 0.9em; margin-left: 0">
                  <li>Build up to specific pkgs - including recursive dependencies: <code>--packages-up-to pkgX</code></li>
                </ul>
              </li>
              <li class="fragment" data-fragment-index="3">Process all recursive downstream packages of <code>pkgY</code>?
                <ul style="font-size: 0.9em; margin-left: 0">
                  <li>Including <code>pkgX</code>: <code>--packages-above &lt;pkgY&gt;</code></li>
                  <li>Excluding <code>pkgX</code>: <code>--packages-select-by-dep &lt;pkgY&gt;</code></li>
                </ul>
              </li>
              <li class="fragment" data-fragment-index="4" style="padding-top: 1em">See section <b style="color: #44497a">Package selection arguments</b> in e.g.  <code>colcon build --help</code>
                <ul style="font-size: 0.9em; margin-left: 0">
                  <li>E.g. <code>--packages-select-regex &lt;regex&gt;</code>, <code>--packages-select-build-failed</code></li>
                </ul>
              </li>
            </ul>

            <p class="fragment fragment-current" data-fragment-index="2" style="position: absolute; right: 0; top: 8%; width: 35%">
              <img style="margin-bottom: 0" src="image/colcon-graph-selected.png" width="50%" alt=""/><br/>
            </p>

            <p class="fragment" data-fragment-index="5" style="font-size: 0.75em; font-style: italic; padding-left: 9em; text-align: left">
              Note: there are options to <code>skip</code> packages.
              Skipping is different from previous seen ignoring.
              The former doesn't process the package but uses it as a dependency for others.
              The later is equal to the package not being in the workspace.
            </p>
            <aside class="notes">
              <i>Finish by 12:45 min.</i>
            </aside>
          </section>

          <section>
            <h2>More Complex Package Selection</h2>
            <p style="font-size: 0.9em; padding-top: 1em; text-align: left">
              Sometimes the existing package selection arguments<br/>aren't covering what you want to select / skip.
            </p>

            <ol style="font-size: 0.8em; margin-left: 0">
              <li class="fragment" style="padding-top: 2em">Combined logic using nested invocations:
                <ul style="font-size: 0.9em; margin-left: 0">
                  <li>E.g. use <code>--packages-up-to</code> but with multiple package names matching a regular expression:
                    <ul style="font-size: 0.9em; margin-left: 0">
                      <li>Use <code>colcon list --packages-select-regex &lt;regex&gt;</code> to determine the set of packages</li>
                      <li>Use <code>--packages-up-to</code> with the result of the previous determined package names</li>
                    </ul>
                  </li>
                  <li>
                    <code>colcon build --packages-up-to `colcon list --packages-select-regex &lt;regex&gt;`</code>
                  </li>
                </ul>
              </li>
              <li class="fragment" style="padding-top: 2em">Write your own package selection option:
                <ul style="font-size: 0.9em; margin-left: 0">
                  <li>Any Python package can contribute an extension providing additional command line arguments</li>
                </ul>
              </li>
            </ol>
            <aside class="notes">
              <i>Finish by 13:45 min.</i>
            </aside>
          </section>
        </section>

        <section>
          <h2><code>test</code> / <code>test-result</code> Command</h2>
          <ul style="font-size: 0.85em; margin-left: 0">
            <li>
              Test all packages in the workspace: <code>colcon test</code>
              <ul style="font-size: 0.9em; margin-left: 0">
                <li><i>Note: must <code>build</code> a package before testing</i></li>
                <li>E.g. pass custom CTest / pytest args: <code>--ctest-args</code> / <code>--pytest-args</code></li>
                <li class="fragment">Dealing with flaky tests:
                  <ul style="font-size: 0.9em">
                    <li>Identify flaky tests: <code>--retest-until-fail N</code></li>
                    <li>Get flaky tests to pass: <code>--retest-until-pass N</code></li>
                  </ul>
                </li>
                <li class="fragment"><span style="color: #44497a">Package Selection</span> arguments:
                  <ul style="font-size: 0.9em">
                    <li>After making changes to a package <code>build</code> and <code>test</code> the package itself<br/>as well as all downstream packages: <code>--packages-above</code></li>
                    <li>Retesting pkgs with test failures in previous runs: <code>--packages-select-test-failures</code></li>
                  </ul>
                <li class="fragment">Failing tests by default still result in a return code of zero (meaning the tests were successfully run)
                  <ul style="font-size: 0.9em">
                    <li>To change that pass <code>--return-code-on-test-failure</code></li>
                  </ul>
                </li>
              </ul>
              <br/>
            </li>
            <li class="fragment">
              Get a summary of all failed tests: <code>colcon test-result</code>
              <ul style="font-size: 0.9em">
                <li>Show additional information about failed tests: <code>--verbose</code></li>
                <li>Start fresh, remove previous test results: <code>--delete</code></li>
              </ul>
            </li>
          </ul>
          <aside class="notes">
            <i>Finish by 15:00 min.</i>
          </aside>
        </section>

        <section>
          <h2 style="text-align: left;">Pointers</h2>
          <ul>
            <li><code>colcon --help</code> / <code>colcon &lt;command&gt; --help</code></li>
            <li><a href="https://colcon.readthedocs.io/">colcon.readthedocs.io</a></li>
            <li>For more context: <a href="http://design.ros2.org/articles/build_tool.html">ROS 2 Design Article</a></li>
            <li><a href="https://colcon.readthedocs.io/en/released/developer/contribution.html">How to contribute</a>, improvements, bug fixes and documentation
              <ul>
                <li>Already many contributed extensions: bazel, bundle, cargo, gradle, lcov-result, sanitizer-reports, spawn-shell, ...</li>
              </ul>
            </li>
            <li>Use it with <a href="https://index.ros.org/doc/ros2/Tutorials/Colcon-Tutorial/">ROS 2</a>, <a href="https://colcon.readthedocs.io/en/released/migration/catkin_make_isolated.html">ROS 1</a>, <a href="http://gazebosim.org/tutorials?tut=ros2_installing">Gazebo</a>, <a href="https://ignitionrobotics.org/docs/acropolis/install#option-3-source-installation-any-platform-">Ingition</a>, ...</li>
          </ul>
          <br/>
          <h2 class="fragment" data-fragment-index="1" style="text-align: left;">Questions...</h2>
          <img class="fragment" data-fragment-index="1" src="image/qrcode_2019-11-01_roscon_colcon.svg" width="20%" style="text-align: left;" alt=""/>
        </section>
      </div>
    </div>

    <script src="js/reveal.js"></script>

    <script>
      // More info https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        history: true,

        // More info https://github.com/hakimel/reveal.js#dependencies
        dependencies: [
          { src: 'plugin/markdown/marked.js' },
          { src: 'plugin/markdown/markdown.js' },
          { src: 'plugin/notes/notes.js', async: true },
          { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
        ]
      });
      var previous_index_h = 0;
      var previous_index_v = 0;
      Reveal.addEventListener( 'slidechanged', function(event) {
        if (event.previousSlide) {
          if (event.indexh > previous_index_h) {
            document.getElementById('openrobotics-logo-clockwise').beginElement();
          } else if (event.indexh < previous_index_h) {
            document.getElementById('openrobotics-logo-counterclockwise').beginElement();
          } else if (event.indexv > previous_index_v) {
            document.getElementById('openrobotics-logo-clockwise').beginElement();
          } else if (event.indexv < previous_index_v) {
            document.getElementById('openrobotics-logo-counterclockwise').beginElement();
          }
          var animation = Reveal.getCurrentSlide().getAttribute('data-animation');
          if (animation) {
            function startAnimation(element) {
              element.beginElement();
            }
            setTimeout(startAnimation, 1500, document.getElementById(animation));
          }
        }
        previous_index_h = event.indexh;
        previous_index_v = event.indexv;
      });
      Reveal.addEventListener('fragmentshown', function(event) {
        document.getElementById('openrobotics-logo-flash').beginElement();
      });
      Reveal.addEventListener('fragmenthidden', function(event) {
        document.getElementById('openrobotics-logo-flash').beginElement();
      });
    </script>
  </body>
</html>
